@using RealEstateSystem.Models
@model RealEstateSystem.ViewModels.PropertyDetailsViewModel

<style>
    .property-details-wrapper {
        max-width: 1200px;
        margin: 0 auto;
    }

    .property-details-header {
        margin-bottom: 1.5rem;
    }

        .property-details-header h2 {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: .25rem;
        }

        .property-details-header p {
            color: #6b7280;
            font-size: 0.95rem;
        }

    .property-details-layout {
        display: grid;
        grid-template-columns: 2fr 1.6fr;
        gap: 1.75rem;
    }

    .property-gallery {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .property-main-photo {
        border-radius: 1rem;
        overflow: hidden;
        background: #e5e7eb;
        min-height: 260px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

        .property-main-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

    .property-main-photo-empty {
        font-size: 0.9rem;
        color: #6b7280;
    }

    .property-thumbs {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
        gap: 0.5rem;
    }

    .property-thumb {
        border-radius: 0.75rem;
        overflow: hidden;
        border: 2px solid transparent;
        cursor: pointer;
        height: 70px;
    }

        .property-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .property-thumb.active {
            border-color: #2563eb;
        }

    .property-info-card {
        border-radius: 1.25rem;
        background: #ffffff;
        box-shadow: 0 24px 60px rgba(15,23,42,0.08);
        padding: 1.25rem 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .property-price {
        font-size: 1.4rem;
        font-weight: 700;
        color: #111827;
    }

    .property-meta-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        font-size: 0.88rem;
        color: #4b5563;
    }

    .property-meta-pill {
        padding: 0.25rem 0.65rem;
        border-radius: 999px;
        background: #eff6ff;
        color: #1d4ed8;
        font-weight: 500;
    }

    .property-section-title {
        font-size: 0.95rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
    }

    .property-description {
        font-size: 0.9rem;
        color: #374151;
        line-height: 1.5;
    }

    .property-detail-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 0.35rem 1.5rem;
        font-size: 0.88rem;
    }

    .property-detail-label {
        color: #6b7280;
    }

    .property-detail-value {
        font-weight: 500;
        color: #111827;
    }

    .property-seller-card {
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        border-top: 1px solid #e5e7eb;
        font-size: 0.88rem;
    }

    .property-seller-name {
        font-weight: 600;
        margin-bottom: 0.15rem;
    }

    @@media (max-width: 1024px) {
        .property-details-layout {
            grid-template-columns: 1fr;
        }
    }
</style>

@{
    var property = Model.Property;
    var images = (Model.Images ?? Enumerable.Empty<PropertyImage>())
                 .OrderBy(i => i.DisplayOrder)
                 .ToList();

    var mainImage = images.FirstOrDefault(i => i.IsPrimary) ?? images.FirstOrDefault();

    string fullAddress = string.Join(", ",
        new[] { property.Address, property.AreaOrLocation, property.City, property.State, property.ZipCode }
            .Where(part => !string.IsNullOrWhiteSpace(part)));
}

<div class="property-details-wrapper">
    <div class="property-details-header">
        <h2>@property.Title</h2>
        <p>@fullAddress</p>
    </div>

    <div class="property-details-layout">
        <!-- LEFT: GALLERY -->
        <div class="property-gallery">
            <div class="property-main-photo" id="mainPhotoContainer">
                @if (mainImage != null)
                {
                    <img id="mainPhoto"
                         src="@mainImage.ImageUrl"
                         alt="@property.Title" />
                }
                else
                {
                    <div class="property-main-photo-empty">
                        No photos uploaded yet for this property.
                    </div>
                }
            </div>

            @if (images.Any())
            {
                <div class="property-thumbs" id="thumbStrip">
                    @foreach (var img in images)
                    {
                        var isActive = mainImage != null && img.ImageId == mainImage.ImageId;
                        <div class="property-thumb @(isActive ? "active" : "")"
                             data-img="@img.ImageUrl">
                            <img src="@img.ImageUrl" alt="@property.Title" />
                        </div>
                    }
                </div>
            }
        </div>

        <!-- RIGHT: INFO -->
        <div class="property-info-card">
            <div>
                <div class="property-price">
                    BDT @property.Price.ToString("N2")
                </div>
                <div class="property-meta-row" style="margin-top: .35rem;">
                    <span class="property-meta-pill">@property.PropertyType</span>
                    <span> @property.AreaSqft sq ft</span>
                    @if (property.Bedrooms.HasValue)
                    {
                        <span>@property.Bedrooms.Value Bedroom(s)</span>
                    }
                    @if (property.Bathrooms.HasValue)
                    {
                        <span>@property.Bathrooms.Value Bathroom(s)</span>
                    }
                    @if (property.YearBuilt.HasValue)
                    {
                        <span>Built @property.YearBuilt</span>
                    }
                </div>
            </div>

            @if (!string.IsNullOrWhiteSpace(property.Description))
            {
                <div>
                    <div class="property-section-title">Description</div>
                    <p class="property-description">
                        @property.Description
                    </p>
                </div>
            }

            <div>
                <div class="property-section-title">Details</div>
                <div class="property-detail-grid">
                    <div class="property-detail-label">Status</div>
                    <div class="property-detail-value">@property.Status</div>

                    <div class="property-detail-label">Approval</div>
                    <div class="property-detail-value">@property.ApprovalStatus</div>

                    <div class="property-detail-label">Created</div>
                    <div class="property-detail-value">@property.CreatedDate.ToString("dd MMM yyyy")</div>

                    @if (property.UpdatedDate.HasValue)
                    {
                        <div class="property-detail-label">Last updated</div>
                        <div class="property-detail-value">@property.UpdatedDate.Value.ToString("dd MMM yyyy")</div>
                    }
                </div>
            </div>

            <div class="property-seller-card">
                <div class="property-section-title">Seller</div>
                <div class="property-seller-name">
                    @(Model.SellerName ?? "N/A")
                </div>
                @if (!string.IsNullOrWhiteSpace(Model.SellerEmail))
                {
                    <div>Email: @Model.SellerEmail</div>
                }
                @if (!string.IsNullOrWhiteSpace(Model.SellerPhone))
                {
                    <div>Phone: @Model.SellerPhone</div>
                }
            </div>
        </div>
    </div>
</div>

@if (images.Any())
{
    <script>
        (function () {
            const main = document.getElementById("mainPhoto");
            const thumbs = document.querySelectorAll(".property-thumb");

            if (!main || !thumbs.length) return;

            thumbs.forEach(t => {
                t.addEventListener("click", function () {
                    const url = this.getAttribute("data-img");
                    if (!url) return;

                    main.setAttribute("src", url);

                    thumbs.forEach(x => x.classList.remove("active"));
                    this.classList.add("active");
                });
            });
        })();
    </script>
}
