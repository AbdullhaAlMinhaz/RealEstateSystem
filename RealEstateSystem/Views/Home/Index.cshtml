@model RealEstateSystem.ViewModels.HomeIndexViewModel
@using System.Linq

@{
    ViewData["Title"] = "Real Estate Property Listing & Selling System";
}

<main>
    <!-- HERO -->
    <section class="hero" id="home">
        <div class="container hero-inner">
            <div class="hero-grid">
                <!-- Left text -->
                <div class="hero-text">
                    <h1 class="hero-title">
                        Find your best <span>spaces</span>.
                    </h1>
                    <p class="hero-subtitle">
                        Search and find your dream home with verified listings from trusted
                        sellers, approved by the admin of the system.
                    </p>
                    <div class="hero-small-meta">
                        <p><strong>Real Estate Property Listing and Selling System</strong></p>
                        <p>Admin • Seller • Buyer – connected inside one platform.</p>
                    </div>

                    <div class="hero-highlight">
                        <span class="hero-badge">Featured property</span>
                        <div class="hero-highlight-text">
                            <p class="hero-highlight-title">Modern Open-Plan Apartment</p>
                            <p class="hero-highlight-meta">3-bed · 2-bath · Dhaka, Bashundhara · 12,000,000</p>
                        </div>
                    </div>

                </div>

                <!-- Right card (image) -->
                <div class="hero-image-card">
                    <div class="hero-image">
                        <img src="~/images/appartment 01.jpg" alt="Modern open-plan apartment">
                    </div>
                    <div class="hero-image-info">
                        <div>
                            <p class="hero-image-title">Modern Open-Plan Apartment</p>
                            <p class="hero-image-location">Dhaka • Bashundhara</p>
                        </div>
                        <p class="hero-image-price">$120,000</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- HOW IT WORKS -->
    <section class="section" id="how-it-works">
        <div class="container">
            <h2 class="section-title">How it works</h2>
            <p class="section-subtitle">
                A simple workflow that connects Admins, Sellers and Buyers inside your Real Estate
                Property Listing and Selling System.
            </p>

            <div class="how-grid">
                <article class="how-card">
                    <div class="how-icon">🔎</div>
                    <h3>Research</h3>
                    <p>
                        Buyers search properties using filters such as location, price,
                        number of bedrooms and more.
                    </p>
                </article>

                <article class="how-card">
                    <div class="how-icon">📨</div>
                    <h3>Contact</h3>
                    <p>
                        Buyers send inquiry emails and schedule property visits. Sellers respond
                        and manage offers.
                    </p>
                </article>

                <article class="how-card">
                    <div class="how-icon">📅</div>
                    <h3>Visit</h3>
                    <p>
                        Visits and negotiations are handled, offers are accepted, and Admin tracks
                        approved &amp; sold properties in the system.
                    </p>
                </article>
            </div>
        </div>
    </section>

    <!-- PROPERTIES LIST -->
    <section class="section" id="properties">
        <div class="container">
            <h2 class="section-title">Properties available for sale</h2>
            <p class="section-subtitle">
                Public visitors can preview featured properties here. After login, Buyers will see
                full details, map view, offers and payment options.
            </p>

            <!-- Search strip -->
            <section class="search-strip">
                <div class="container search-strip-inner">
                    <form class="hero-search" id="searchForm" method="get" asp-controller="Home" asp-action="Index">
                        <div class="search-field">
                            <span class="search-label">Search</span>
                            <input type="text"
                                   name="location"
                                   value="@Model?.Location"
                                   placeholder="City / Area (e.g., Dhanmondi, Gulshan)" />
                        </div>
                        <div class="search-field">
                            <span class="search-label">Property Type</span>
                            <select name="propertyType">
                                <option value="">Any type</option>
                                @foreach (var pt in System.Enum.GetValues(typeof(RealEstateSystem.Models.PropertyType)).Cast<RealEstateSystem.Models.PropertyType>())
                                {
                                    <option value="@pt" selected="@(Model?.PropertyType == pt ? "selected" : null)">@pt</option>
                                }
                            </select>
                        </div>
                        <div class="search-field">
                            <span class="search-label">Price (Min)</span>
                            <input type="number" name="minPrice" value="@(Model?.MinPrice)" placeholder="$ Min" />
                        </div>
                        <div class="search-field">
                            <span class="search-label">Price (Max)</span>
                            <input type="number" name="maxPrice" value="@(Model?.MaxPrice)" placeholder="$ Max" />
                        </div>
                        <button type="submit" class="btn btn-primary search-btn">
                            Search
                        </button>
                    </form>
                    <p class="search-note">
                        🔒 Full search results are available only after <strong>Login / Registration</strong>.
                    </p>
                </div>
            </section>

            <!-- PROPERTY CARDS (dynamic) -->
            <div class="properties-grid">
                @if (Model?.Properties == null || !Model.Properties.Any())
                {
                    <p style="padding: 20px; color: #666;">No properties found.</p>
                }
                else
                {
                    foreach (var p in Model.Properties)
                    {
                        // Safe image url (supports relative or absolute)
                        var imgRaw = p.PrimaryImageUrl;
                        var imgUrl = string.IsNullOrWhiteSpace(imgRaw)
                        ? Url.Content("~/images/appartment 01.jpg")
                        : (imgRaw.StartsWith("http", System.StringComparison.OrdinalIgnoreCase)
                        ? imgRaw
                        : Url.Content(imgRaw.StartsWith("~") ? imgRaw : ("~/" + imgRaw.TrimStart('/'))));

                        var bedText = p.Bedrooms.HasValue ? $"{p.Bedrooms}-bed" : null;
                        var bathText = p.Bathrooms.HasValue ? $"{p.Bathrooms}-bath" : null;
                        var typeLine = string.Join(", ", new[] { bedText, bathText }.Where(x => !string.IsNullOrWhiteSpace(x)));

                        var locationLine = !string.IsNullOrWhiteSpace(p.AreaOrLocation)
                        ? p.AreaOrLocation
                        : string.Join(", ", new[] { p.City, p.State }.Where(x => !string.IsNullOrWhiteSpace(x)));

                        <article class="property-card">
                            <div class="property-image">
                                <img src="@imgUrl" alt="Property image">
                            </div>
                            <div class="property-body">
                                <!-- ✅ Price comes directly from DB (no helper file) -->
                                <p class="property-price">@(p.Price.ToString("N0")) tk</p>

                                <p class="property-type">@typeLine</p>
                                <p class="property-location">@locationLine</p>

                                <!-- Keep same UI button, but link to details -->
                                <a class="btn btn-details"
                                   asp-controller="BuyerProperties"
                                   asp-action="Details"
                                   asp-route-id="@p.PropertyId">Details</a>
                            </div>
                        </article>
                    }
                }
            </div>

            <!-- PAGINATION (dynamic) -->
            <div class="pagination">
                @if (Model != null && Model.TotalPages > 1)
                {
                    for (int i = 1; i <= Model.TotalPages; i++)
                    {
                        var active = i == Model.Page ? "active" : "";
                        <a class="pagination-btn @active"
                           asp-controller="Home"
                           asp-action="Index"
                           asp-route-location="@Model.Location"
                           asp-route-propertyType="@(Model.PropertyType)"
                           asp-route-minPrice="@(Model.MinPrice)"
                           asp-route-maxPrice="@(Model.MaxPrice)"
                           asp-route-page="@i"
                           asp-fragment="properties">@i</a>

                    }
                }
                else
                {
                    // Keeps your pagination area clean even if only one page
                    <button class="pagination-btn active" type="button">1</button>
                }
            </div>

        </div>
    </section>
</main>

<!-- ABOUT US -->
<section class="section" id="about-us">
    <div class="container">
        <h2 class="section-title">About Us</h2>
        <p class="section-subtitle">
            EstateFlow is a university project that demonstrates a complete Real Estate
            Property Listing and Selling System where Admins, Sellers and Buyers can
            work together in a secure and organized platform.
        </p>

        <div class="about-grid">
            <div class="about-left">
                <h3>Our Purpose</h3>
                <p>
                    The main goal of this system is to connect property owners and buyers
                    in a transparent way. Admin verifies Sellers and approves property
                    listings before they go public so that buyers can trust the platform.
                </p>

                <h3>What You Can Showcase</h3>
                <ul>
                    <li>Role-based access: Admin, Seller (Agent / Owner), Buyer</li>
                    <li>Secure login &amp; registration with controlled property search</li>
                    <li>Property listing, offers, bookings and receipt generation</li>
                    <li>Analytics dashboard for Admin and performance stats for Seller</li>
                </ul>
            </div>

            <div class="about-right">
                <div class="about-card">
                    <h4>For Admin</h4>
                    <p>
                        Manage users, approve properties, mark listings as sold or
                        removed, and generate monthly reports of activity.
                    </p>
                </div>
                <div class="about-card">
                    <h4>For Sellers</h4>
                    <p>
                        Create property listings with images, reply to inquiries,
                        handle offers and track which listings perform best.
                    </p>
                </div>
                <div class="about-card">
                    <h4>For Buyers</h4>
                    <p>
                        Search properties after login, send inquiries by email,
                        submit offers and download booking confirmations or receipts.
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CONTACT -->
<section class="section" id="contact">
    <div class="container">
        <h2 class="section-title">Contact Us</h2>
        <p class="section-subtitle">Need help? Have questions? Reach us anytime.</p>

        <div class="contact-grid">
            <div class="contact-card">
                <h3>📍 Address</h3>
                <p>Road #12, House #34, Bashundhara R/A, Dhaka, Bangladesh</p>

                <h3>📞 Phone</h3>
                <p>+880 1234 567 890</p>

                <h3>📧 Email</h3>
                <p>support@estateflow.com</p>
            </div>

            <div class="contact-map">
                <iframe width="100%" height="100%"
                        frameborder="0" style="border:0; border-radius:16px;"
                        src="https://maps.google.com/maps?q=Bashundhara%20Dhaka&t=&z=13&ie=UTF8&iwloc=&output=embed"
                        allowfullscreen>
                </iframe>
            </div>
        </div>
    </div>

    @await Html.PartialAsync("~/Views/Account/Login.cshtml", new RealEstateSystem.ViewModels.LoginViewModel())
    @await Html.PartialAsync("~/Views/Account/Register.cshtml", new RealEstateSystem.ViewModels.RegisterViewModel())

    @if (TempData["OpenLoginModal"] != null)
    {
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var modal = document.getElementById('loginModal');
                if (modal) {
                    modal.classList.add('open');
                    modal.setAttribute('aria-hidden', 'false');
                    document.body.classList.add('no-scroll');
                }
            });
        </script>
    }
</section>
