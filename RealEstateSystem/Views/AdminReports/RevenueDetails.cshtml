@model RealEstateSystem.ViewModels.AdminRevenueDetailsViewModel

@{
    Layout = "_AdminLayout";
}

<style>
    .rev-wrap { display:flex; flex-direction:column; gap:1.25rem; }
    .rev-card {
        background:#fff;
        border-radius:18px;
        padding:18px 20px;
        box-shadow:0 12px 30px rgba(0,0,0,.06);
        display:flex; justify-content:space-between; align-items:flex-start;
    }
    .rev-card h3 { margin:0; font-size:14px; letter-spacing:.04em; text-transform:uppercase; opacity:.7; }
    .rev-card .amount { font-size:30px; font-weight:800; margin-top:6px; }
    .filter-bar {
        display:flex; flex-wrap:wrap; gap:10px; align-items:center;
        background:#fff; border-radius:18px; padding:14px 16px;
        box-shadow:0 12px 30px rgba(0,0,0,.06);
    }
    .filter-bar select, .filter-bar input {
        border:1px solid rgba(0,0,0,.12);
        border-radius:999px;
        padding:8px 12px;
        outline:none;
        background:#fff;
    }
    .filter-bar button {
        border:none;
        border-radius:999px;
        padding:9px 16px;
        font-weight:700;
        background:#2f7cf6;
        color:#fff;
    }
    .table-card {
        background:#fff;
        border-radius:18px;
        padding:16px;
        box-shadow:0 12px 30px rgba(0,0,0,.06);
    }
    table { width:100%; border-collapse:collapse; }
    th { text-align:left; font-size:12px; letter-spacing:.04em; text-transform:uppercase; opacity:.65; padding:12px 10px; }
    td { padding:12px 10px; border-top:1px solid rgba(0,0,0,.06); vertical-align:top; }
    .muted { opacity:.7; font-size:12px; margin-top:2px; }
    .btn-view {
        display:inline-block;
        padding:8px 12px;
        border-radius:999px;
        background:#111827;
        color:#fff;
        text-decoration:none;
        font-weight:700;
        font-size:13px;
    }
    .sum-row { display:flex; justify-content:flex-end; padding-top:14px; font-size:16px; font-weight:800; }
</style>

<div class="rev-wrap">

    <!-- Top Total Card -->
    <div class="rev-card">
        <div>
            <h3>Total Revenue (Commission)</h3>
            <div class="amount">৳ @Model.TotalRevenue.ToString("N0")</div>
            <div class="muted">Sum of paid commission invoices in selected period</div>
        </div>
        <div class="muted">
            Period: @Model.StartDate.ToString("dd MMM yyyy") - @Model.EndDate.ToString("dd MMM yyyy")
        </div>
    </div>

    <!-- Filter Bar -->
    <form class="filter-bar" method="get" asp-action="RevenueDetails" asp-controller="AdminReports">
        <select name="range">
            <option value="7" selected="@(Model.Range == "7")">Last 7 days</option>
            <option value="30" selected="@(Model.Range == "30")">Last 30 days</option>
            <option value="90" selected="@(Model.Range == "90")">Last 90 days</option>
            <option value="365" selected="@(Model.Range == "365")">Last 1 year</option>
            <option value="custom" selected="@(Model.Range == "custom")">Custom</option>
        </select>

        <input type="date" name="startDate" value="@Model.StartDate.ToString("yyyy-MM-dd")" />
        <span class="muted">to</span>
        <input type="date" name="endDate" value="@Model.EndDate.ToString("yyyy-MM-dd")" />

        <button type="submit">Apply</button>
    </form>

    <!-- Details Table -->
    <div class="table-card">
        <h3 style="margin:0 0 10px 0;">Revenue Breakdown</h3>

        <table>
            <thead>
                <tr>
                    <th>Invoice</th>
                    <th>Property</th>
                    <th>Seller</th>
                    <th>Listing Price</th>
                    <th>Rate</th>
                    <th>Commission</th>
                    <th>Paid Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Invoices == null || Model.Invoices.Count == 0)
                {
                    <tr>
                        <td colspan="8" class="muted">No paid commission invoices found for this period.</td>
                    </tr>
                }
                else
                {
                    foreach (var row in Model.Invoices)
                    {
                        <tr>
                            <td>#@row.CommissionInvoiceId</td>
                            <td>
                                <div><strong>@row.PropertyTitle</strong></div>
                                <div class="muted">@row.PropertyCity</div>
                                <div class="muted">@row.PropertyAddress</div>
                            </td>
                            <td>@row.SellerName</td>
                            <td>৳ @row.ListingPrice.ToString("N0")</td>
                            <td>@row.CommissionRatePercent%</td>
                            <td><strong>৳ @row.CommissionAmount.ToString("N0")</strong></td>
                            <td>@(row.VerifiedDate?.ToString("dd MMM yyyy") ?? "-")</td>
                            <td>
                                <a class="btn-view"
                                   asp-controller="AdminProperties"
                                   asp-action="Details"
                                   asp-route-id="@row.PropertyId">
                                    View
                                </a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>

        <!-- Bottom Total Sum -->
        <div class="sum-row">
            Total Revenue: ৳ @Model.TotalRevenue.ToString("N0")
        </div>
    </div>

</div>
