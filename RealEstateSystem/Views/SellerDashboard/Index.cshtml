@model RealEstateSystem.ViewModels.SellerDashboardViewModel

@{
    Layout = "~/Views/Shared/_SellerLayout.cshtml";

    string FormatInquiryDate(DateTime dt)
    {
        // Simple format, you can change to "Today • 11:10 AM" style if you want
        return dt.ToString("dd MMM yyyy • hh:mm tt");
    }
}

<main class="content">

    <!-- TOP OVERVIEW CARDS -->
    <section class="grid grid-4 overview">
        <article class="stat-card is-active">
            <p class="stat-label">Active Listings</p>
            <p class="stat-value"
               data-counter
               data-target="@Model.ActiveListings">0</p>
            <p class="stat-meta">Visible to buyers</p>
        </article>

        <article class="stat-card">
            <p class="stat-label">Pending Approval</p>
            <p class="stat-value"
               data-counter
               data-target="@Model.PendingApproval">0</p>
            <p class="stat-meta">Waiting for admin review</p>
        </article>

        <article class="stat-card">
            <p class="stat-label">Sold / Rented</p>
            <p class="stat-value"
               data-counter
               data-target="@Model.SoldOrRented">0</p>
            <p class="stat-meta">Completed deals</p>
        </article>

        <article class="stat-card">
            <p class="stat-label">Total Inquiries</p>
            <p class="stat-value"
               data-counter
               data-target="@Model.TotalInquiriesLast30Days">0</p>
            <p class="stat-meta">Last 30 days</p>
        </article>
    </section>

    <!-- MIDDLE ROW: LISTINGS OVERVIEW + LATEST INQUIRIES -->
    <section class="grid grid-2 middle">
        <!-- LISTINGS OVERVIEW (mini chart) -->
        <article class="card">
            <div class="card-header">
                <h2>Listings Performance</h2>
                <span class="card-tag">Last 6 months</span>
            </div>

            <div class="chart-sample">
                <div class="chart-legend">
                    <span><span class="legend-dot legend-views"></span> Views</span>
                    <span><span class="legend-dot legend-inquiries"></span> Inquiries</span>
                    <span><span class="legend-dot legend-offers"></span> Offers</span>
                </div>

                <div class="chart-bars">
                    @foreach (var stat in Model.MonthlyStats)
                    {
                        <div class="chart-col"
                             data-month="@stat.MonthLabel"
                             data-views="@stat.Views"
                             data-inquiries="@stat.Inquiries"
                             data-offers="@stat.Offers">
                            <div class="bar-group">
                                <div class="bar bar-views"></div>
                                <div class="bar bar-inquiries"></div>
                                <div class="bar bar-offers"></div>
                            </div>
                            <span class="chart-label">@stat.MonthLabel</span>
                        </div>
                    }
                </div>
            </div>
        </article>

        <!-- LATEST INQUIRIES -->
        <article class="card">
            <div class="card-header">
                <h2>Latest Inquiries</h2>
                <a href="#" class="card-link">View all inquiries</a>
            </div>

            <ul class="inquiry-list" id="inquiryList">
                @if (Model.LatestInquiries != null && Model.LatestInquiries.Any())
                {
                    foreach (var inquiry in Model.LatestInquiries)
                    {
                        <li>
                            <div>
                                <p class="inquiry-title">@inquiry.PropertyTitle</p>
                                <p class="inquiry-meta">
                                    From:
                                    <span class="highlight">@inquiry.BuyerName</span>
                                    • @FormatInquiryDate(inquiry.InquiryDate)
                                </p>
                            </div>
                            <button class="@inquiry.StatusCssClass">
                                @inquiry.StatusText
                            </button>
                        </li>
                    }
                }
                else
                {
                    <li>
                        <p class="inquiry-meta">No inquiries found yet.</p>
                    </li>
                }
            </ul>
        </article>
    </section>

    <!-- BOTTOM ROW: OFFERS + TOP PROPERTIES -->
    <section class="grid grid-2 bottom">
        <!-- RECENT OFFERS -->
        <article class="card">
            <div class="card-header">
                <h2>Recent Offers</h2>
                <a href="#" class="card-link">Manage offers</a>
            </div>

            <table class="table">
                <thead>
                    <tr>
                        <th>Property</th>
                        <th>Buyer</th>
                        <th>Offered Price</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="offersBody">
                    @if (Model.RecentOffers != null && Model.RecentOffers.Any())
                    {
                        foreach (var offer in Model.RecentOffers)
                        {
                            <tr>
                                <td>@offer.PropertyTitle</td>
                                <td>@offer.BuyerName</td>
                                <td>BDT @offer.OfferAmount.ToString("N2")</td>
                                <td>
                                    <span class="@offer.StatusBadgeClass">
                                        @offer.StatusText
                                    </span>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4">No offers found.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </article>

        <!-- TOP PERFORMING PROPERTIES -->
        <article class="card">
            <div class="card-header">
                <h2>Top Performing Properties</h2>
                <span class="card-tag">Based on views & inquiries</span>
            </div>

            <table class="table">
                <thead>
                    <tr>
                        <th>Property</th>
                        <th>Views</th>
                        <th>Inquiries</th>
                        <th>Offers</th>
                    </tr>
                </thead>
                <tbody id="topPropertiesBody">
                    @if (Model.TopProperties != null && Model.TopProperties.Any())
                    {
                        foreach (var p in Model.TopProperties)
                        {
                            <tr>
                                <td>@p.PropertyTitle</td>
                                <td>@p.Views</td>
                                <td>@p.Inquiries</td>
                                <td>@p.Offers</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4">No property performance data available.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </article>
    </section>
</main>
